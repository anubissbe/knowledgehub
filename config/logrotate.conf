# Logrotate configuration for KnowledgeHub services

# API Gateway logs
/opt/projects/knowledgehub/logs/api/*.log {
    daily
    rotate 14
    maxsize 100M
    missingok
    notifempty
    compress
    delaycompress
    create 0644 root root
    sharedscripts
    postrotate
        docker kill -s USR1 knowledgehub-api 2>/dev/null || true
    endscript
}

# Scraper service logs
/opt/projects/knowledgehub/logs/scraper/*.log {
    daily
    rotate 7
    maxsize 50M
    missingok
    notifempty
    compress
    delaycompress
    create 0644 root root
}

# RAG Processor logs
/opt/projects/knowledgehub/logs/rag/*.log {
    daily
    rotate 7
    maxsize 50M
    missingok
    notifempty
    compress
    delaycompress
    create 0644 root root
}

# Scheduler logs
/opt/projects/knowledgehub/logs/scheduler/*.log {
    weekly
    rotate 4
    maxsize 20M
    missingok
    notifempty
    compress
    delaycompress
    create 0644 root root
}

# Backup logs
/opt/projects/knowledgehub/logs/backup.log {
    monthly
    rotate 12
    maxsize 10M
    missingok
    notifempty
    compress
    delaycompress
    create 0644 root root
}

# Cleanup logs
/opt/projects/knowledgehub/logs/cleanup.log {
    monthly
    rotate 6
    maxsize 10M
    missingok
    notifempty
    compress
    delaycompress
    create 0644 root root
}

# General application logs
/opt/projects/knowledgehub/logs/*.log {
    weekly
    rotate 4
    maxsize 50M
    missingok
    notifempty
    compress
    delaycompress
    create 0644 root root
    sharedscripts
    postrotate
        # Send SIGHUP to any services that need to reopen log files
        docker kill -s HUP knowledgehub-api 2>/dev/null || true
        docker kill -s HUP knowledgehub-scraper 2>/dev/null || true
        docker kill -s HUP knowledgehub-rag 2>/dev/null || true
    endscript
}